<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Event Manager: Project Description</title>

  <style>
    body {
      font-family: sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 20px;
      background-color: #f4f4f4;
      color: #333;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }

    details {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 10px;
      padding: 10px;
    }

    summary {
      font-weight: bold;
      cursor: pointer;
      padding: 5px;
      outline: none;
      /* Removes the default focus outline which can be distracting */
    }

    summary:hover {
      background-color: #efefef;
    }

    details[open] summary {
      border-bottom: 1px solid #ddd;
      margin-bottom: 10px;
    }

    h2 {
      /* For section titles within details, if needed, though summary often suffices */
      margin-top: 0;
      color: #555;
      font-size: 1.5em;
    }

    h3 {
      color: #444;
      font-size: 1.2em;
      margin-top: 20px;
    }

    ul {
      padding-left: 20px;
    }

    li {
      margin-bottom: 5px;
    }

    pre {
      background: #2d2d2d;
      /* Dark background for code blocks */
      color: #f8f8f2;
      /* Light text for contrast */
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      /* Allow horizontal scrolling for long lines */
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.9em;
    }

    code {
      font-family: 'Courier New', Courier, monospace;
    }

    p {
      margin-bottom: 10px;
    }
  </style>
</head>

<body>
  <main class="container">
    <h1>Event Manager Web Application: Project Description</h1>

    <details>
      <summary>1. Overview</summary>

      <div>
        <p>The Event Manager is a single-page web application (SPA) designed for a single user to efficiently create, view, update, and delete events. Each event will be characterized by its start and finish times, a title, and a detailed description. The application aims to provide a seamless and intuitive user experience with a focus on clear information presentation, straightforward event management, and real-time updates.</p>
      </div>
    </details>

    <details>
      <summary>2. Core Functionality</summary>

      <div>
        <ul>
          <li><strong>Event Management:</strong> Full CRUD (Create, Read, Update, Delete) operations for events.</li>

          <li><strong>Event Attributes:</strong> Each event will store:
            <ul>
              <li><code>id</code>: Automatically generated by MongoDB.</li>
              <li><code>startdt</code>: Start date and time (chosen by user).</li>
              <li><code>finishdt</code>: Finish date and time (chosen by user).</li>
              <li><code>title</code>: A concise title for the event.</li>
              <li><code>description</code>: A detailed description of the event.</li>
              <li><code>createdt</code>: Timestamp of when the event was created (noted automatically).</li>
              <li><code>updatedt</code>: Timestamp of the last update to the event (noted automatically).</li>
            </ul>
          </li>

          <li><strong>Multiple Views:</strong> The application will offer several ways to visualize events:
            <ul>
              <li><strong>Month Calendar View:</strong> A traditional calendar layout displaying events for the selected month.</li>
              <li><strong>Week View:</strong> A view showing events scheduled for the selected week.</li>
              <li><strong>Day View:</strong> A detailed view of events for a specific day.</li>
            </ul>
          </li>

          <li><strong>Single User Focus:</strong> The application is designed for use by a single individual to manage their personal or professional events.</li>
          
          <li><strong>Real-time Updates:</strong> The UI will dynamically reflect changes made to events in the database without requiring a manual refresh, utilizing MongoDB Change Streams and Server-Sent Events (SSE).</li>
        </ul>
      </div>
    </details>

    <details>
      <summary>3. Technology Stack</summary>

      <div>
        <p>The project leverages a modern JavaScript-centric stack with a local MongoDB database configured as a replica set.</p>

        <h3>Integrated Development Environment (IDE):</h3>
        <ul>
          <li>Visual Studio Code (Version: 1.99.3)</li>
        </ul>

        <h3>Operating System:</h3>
        <ul>
          <li>Windows 11 Pro N</li>
        </ul>

        <h3>Backend Technologies:</h3>
        <ul>
          <li><strong>Runtime Environment:</strong> Node.js (Version: 22.1.0)</li>
          <li><strong>Web Framework:</strong> Express.js (Version: 5.1.0) (Note: Express is used for request routing, static file serving, and middleware, abstracted by custom server logic.)</li>
          <li><strong>Module System:</strong> CommonJS</li>
        </ul>

        <h3>Frontend Technologies:</h3>
        <ul>
          <li><strong>Core Languages:</strong> HTML, CSS, JavaScript (Vanilla)</li>
          <li><strong>Module System:</strong> ES Modules (ESM)</li>
          <li><strong>Real-time Communication:</strong> Server-Sent Events (SSE)</li>
        </ul>

        <h3>Database:</h3>
        <ul>
          <li><strong>Database System:</strong> MongoDB (Local Instance, Version: 8.0.9), configured as a singular replica set.</li>
          <li><strong>ODM (Object Data Modeling):</strong> Mongoose (Version: 8.14.1)</li>
          <li><strong>Database Management Tool:</strong> MongoDB Compass (Version: 1.46.1)</li>
          <li><strong>Real-time Feature:</strong> MongoDB Change Streams</li>
        </ul>
      </div>
    </details>

    <details>
      <summary>4. Architectural Principles</summary>

      <div>
        <ul>
          <li><strong>Single Repository:</strong> The entire application (frontend and backend) will reside in a single repository.</li>

          <li><strong>Modularity:</strong> The codebase emphasizes high modularity.
            <ul>
              <li><strong>Backend:</strong> Utilizes CommonJS modules. Core backend responsibilities are separated into distinct modules:
                <ul>
                  <li>Database connection management.</li>
                  <li>Data access, business logic, and Change Stream integration.</li>
                  <li>Server setup (including static file serving), request handling (API routes), and real-time event feed (SSE) management.</li>
                </ul>
                These modules are designed to offer clear, abstracted interfaces for use in the main application entry point (<code>index.js</code>).
              </li>
              <li><strong>Frontend:</strong> Employs ES Modules. UI components (<code>ui.js</code>) and client-side logic (<code>client.js</code>) will also be modular, exporting objects of the same name (e.g., <code>ui.js</code> exports a <code>ui</code> object).</li>
            </ul>
          </li>

          <li><strong>No Build Process:</strong> The project adheres to a "what you write is what you run" philosophy. There will be no bundling, compilation, transpilation, or minification steps involved.</li>

          <li><strong>Code Style:</strong>
            <ul>
              <li><strong>Indentation:</strong> Two spaces.</li>
              <li><strong>Semicolons:</strong> Avoid unnecessary semicolons in JavaScript.</li>
              <li><strong>Comments:</strong> Avoid using comments in code. Instead, write clean and understandable code that is self-documenting. If comments seem needed, write the documentation in a separate file.</li>
              <li><strong>Object/Array Formatting:</strong> Inline for short declarations, multi-line for longer ones to maintain readability.</li>
            </ul>
          </li>

          <li><strong>Real-time Data Synchronization:</strong>
            <ul>
              <li>Utilizes MongoDB Change Streams (requiring a replica set) to detect database modifications in the events collection.</li>
              <li>Backend logic processes these detected changes.</li>
              <li>Updates are pushed to connected clients via Server-Sent Events (SSE).</li>
              <li>The frontend listens for these SSE messages and dynamically updates the UI, ensuring data consistency across views without manual refreshes.</li>
            </ul>
          </li>
        </ul>
      </div>
    </details>

    <details>
      <summary>5. Project Directory Structure</summary>

      <div>
        <p>The project will be organized within a root folder named <code>crude-events-mongo</code>.</p>
        <pre><code>crude-events-mongo/
├── core/                  # Backend modules and logic
│   ├── connect.js         # Mongoose connection setup (exports 'connect' function)
│   ├── db.js              # Exports 'useDB' function (takes mongoose, returns 'db' object with models/logic/changestream setup)
│   ├── server.js          # Exports 'startServer' function (takes port; starts server, returns 'server' object with request/SSE methods, serves static files)
│   └── ...                # Other backend modules as needed
├── public/                # Frontend assets, served statically
│   ├── js/                # Frontend JavaScript modules
│   │   ├── client.js      # Client-side API interaction and SSE listener logic (exports 'client' object)
│   │   └── ui.js          # DOM manipulation and UI components (exports 'ui' object)
│   ├── app.js             # Main frontend JavaScript file (wires 'ui.js', 'client.js')
│   ├── index.html         # Main HTML file for the SPA
│   └── style.css          # CSS styles for the application
├── index.js               # Main backend entry point (wires modules, configures server, starts server)
└── package.json           # Project metadata and dependencies</code></pre>
      </div>
    </details>

    <details>
      <summary>6. Module Interaction and Wiring</summary>

      <div>
        <h3>Backend (<code>index.js</code> in root):</h3>
        <ul>
          <li>This file serves as the primary entry point for the backend.</li>
          <li>It will import and initialize modules from the <code>core/</code> directory.</li>
          <li><strong>Database Connection:</strong> It will first call the <code>connect</code> function from <code>core/connect.js</code> to establish and retrieve the Mongoose connection object.</li>
          <li><strong>Database Logic Initialization:</strong> Then, it will call the <code>useDB</code> function from <code>core/db.js</code>, passing the Mongoose object to it. This yields the <code>db</code> object, which contains models, database interaction methods, and logic for setting up Change Stream listeners. This <code>db</code> object will be accessible to route handlers and Change Stream processing logic.</li>
          <li><strong>Server Initialization and Start:</strong> Next, it will call the <code>startServer</code> function from <code>core/server.js</code>, passing the desired port. This function initializes an Express application, configures static file serving from the <code>public</code> folder, starts the HTTP server, and returns a <code>server</code> object.</li>
          <li><strong>Route and Feeder Configuration:</strong> The <code>index.js</code> will then use the methods of the returned <code>server</code> object to define API routes and SSE feeders on the already running server:
            <ul>
              <li>For API routes: e.g., <code>server.handleRequest('GET', '/api/events', (parsedBody) => db.getAllEvents())</code>. The route handler callback, defined in <code>index.js</code>, accesses the initialized <code>db</code> object from its closure scope to interact with the database. The <code>handleRequest</code> method abstracts the underlying Express routing setup.</li>
              <li>For SSE feeders: e.g., <code>const feedEventsUpdate = server.getFeeder('/sse/events');</code>. A Change Stream listener (which can be initiated and managed via the <code>db</code> object) will use this <code>feedEventsUpdate(changeData)</code> function to broadcast database changes to connected clients. The <code>getFeeder</code> method abstracts SSE setup over Express.</li>
            </ul>
          </li>
        </ul>

        <h3>Frontend (<code>app.js</code> in <code>public/</code>):</h3>
        <ul>
          <li>This file acts as the main script for the frontend.</li>
          <li>It will import and orchestrate modules from the <code>public/js/</code> directory.</li>
          <li>It will use the <code>ui</code> object from <code>public/js/ui.js</code> to manage user interface updates and rendering.</li>
          <li>It will leverage the <code>client</code> object from <code>public/js/client.js</code> to handle communication with the backend API (e.g., fetching and sending event data using routes defined via <code>server.handleRequest</code>) and to establish an SSE connection (to an endpoint set up via <code>server.getFeeder</code>) for receiving real-time updates.</li>
        </ul>
        <p>This structure and approach aim to create a maintainable, scalable, and understandable codebase, adhering to the specified technological and stylistic preferences, with a focus on delivering a responsive and dynamically updated user experience.</p>
      </div>
    </details>
  </main>
</body>

</html>
